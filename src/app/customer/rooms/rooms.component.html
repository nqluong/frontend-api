<!-- Start main-content -->
<section class="page-title" style="background-image: url(assets/customer/images/background/page-title-bg.png);">
    <div class="auto-container">
        <div class="title-outer text-center">
            <h1 class="title" *ngIf="isSearchResult">Kết Quả Tìm Kiếm</h1>
            <h1 class="title" *ngIf="!isSearchResult">Danh Sách Phòng</h1>
            <ul class="page-breadcrumb">
                <li><a routerLink="/customer">Trang Chủ</a></li>
                <li>Danh Sách Phòng</li>
            </ul>
        </div>
    </div>
</section>
<!-- end main-content -->

<!-- rooms-section -->
<section class="rooms-section pb-100">
    <div class="auto-container">
        <div class="row">
            <!-- room-block -->
            <div class="room-block col-lg-6 col-md-6" *ngFor="let room of searchResults">
                <div class="inner-box wow fadeIn">
                    <div class="image-box">
                        <figure class="image-2 overlay-anim">
                            <!-- Sử dụng ảnh đầu tiên từ anhPhong nếu có, nếu không thì sử dụng ảnh mặc định -->
                            <a [routerLink]="['/customer/room-details', room.id]">
                                <img 
                                    *ngIf="room.anhPhong && room.anhPhong.length > 0" 
                                    [src]="'assets/images/AnhPhong/' + room.anhPhong[0]" 
                                    [alt]="room.tenPhong"
                                    onError="this.src='assets/customer/images/resource/room-1.jpg'"
                                >
                                <img 
                                    *ngIf="!room.anhPhong || room.anhPhong.length === 0" 
                                    src="assets/customer/images/resource/room-1.jpg" 
                                    [alt]="room.tenPhong"
                                >
                            </a>
                        </figure>
                    </div>
                    <div class="content-box">
                        <h6 class="title"><a [routerLink]="['/customer/room-details', room.id]">{{room.tenPhong}}</a></h6>
                        <span class="price">{{room.gia | currency:'VND':'symbol':'1.0-0'}} / ĐÊM</span>
                    </div>
                    <div class="box-caption">
                        <a href="javascript:void(0)" class="book-btn" (click)="openBookingModal(room.id)">ĐẶT NGAY</a>
                        <ul class="bx-links">
                            <li *ngFor="let tienNghi of room.tienNghi">
                                <a href="javascript:void(0)">
                                    <i class="fa" [class.fa-wifi]="tienNghi.includes('Wifi')"
                                       [class.fa-tv]="tienNghi.includes('TV')"
                                       [class.fa-snowflake]="tienNghi.includes('Điều hòa') || tienNghi.includes('Air Conditioning')"
                                       [class.fa-utensils]="tienNghi.includes('Bếp') || tienNghi.includes('Kitchenette')"
                                       [class.fa-bath]="tienNghi.includes('Bathtub')"
                                       [class.fa-laptop]="tienNghi.includes('Desk')"></i>
                                </a>
                            </li>
                            <li><a href="javascript:void(0)"><i class="fa fa-bed"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Hiển thị thông báo đang tạo đặt phòng -->
            <div class="col-12 text-center" *ngIf="isCreatingBooking">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Đang xử lý...</span>
                </div>
                <p class="mt-2">Đang xử lý đặt phòng...</p>
            </div>

            <!-- Hiển thị thông báo khi không có kết quả -->
            <div class="col-12 text-center" *ngIf="searchResults.length === 0 && !isCreatingBooking">
                <h3>Không tìm thấy phòng phù hợp với tiêu chí tìm kiếm</h3>
                <a routerLink="/customer" class="theme-btn btn-style-one mt-4">
                    <span class="btn-title">Quay lại trang chủ</span>
                </a>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination-box" *ngIf="!isSearchResult && totalPages > 1">
            <div class="text-center mt-5">
                <ul class="styled-pagination">
                    <li><a href="javascript:void(0)" class="prev" [ngClass]="{'disabled': currentPage === 0}" (click)="currentPage > 0 && loadAllRooms(currentPage - 1)">
                        <i class="fa fa-angle-left"></i>
                    </a></li>

                    <li *ngFor="let page of [].constructor(totalPages); let i = index">
                        <a href="javascript:void(0)" [ngClass]="{'current': i === currentPage}" (click)="loadAllRooms(i)">{{ i + 1 }}</a>
                    </li>

                    <li><a href="javascript:void(0)" class="next" [ngClass]="{'disabled': currentPage === totalPages - 1}" (click)="currentPage < totalPages - 1 && loadAllRooms(currentPage + 1)">
                        <i class="fa fa-angle-right"></i>
                    </a></li>
                </ul>
            </div>
        </div>
    </div>
</section>
<!-- End rooms-section -->

<!-- Booking Modal -->
<div class="custom-modal" id="bookingModal" role="dialog" aria-modal="true" aria-labelledby="bookingModalLabel" *ngIf="showBookingModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="bookingModalLabel">Chọn ngày đặt phòng</h2>
                <button type="button" class="btn-close" (click)="closeBookingModal()" aria-label="Đóng"></button>
            </div>
            <div class="modal-body">
                <form (ngSubmit)="confirmBooking()" #bookingForm="ngForm">
                    <div class="mb-3">
                        <label for="checkInDate" class="form-label">Ngày nhận phòng</label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="checkInDate" 
                            [(ngModel)]="bookingDates.checkIn" 
                            name="checkIn"
                            #checkInPicker
                            placeholder="Chọn ngày nhận phòng"
                            readonly
                            aria-required="true"
                            required
                        >
                    
                    </div>
                    <div class="mb-3">
                        <label for="checkOutDate" class="form-label">Ngày trả phòng</label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="checkOutDate" 
                            [(ngModel)]="bookingDates.checkOut" 
                            name="checkOut"
                            #checkOutPicker
                            placeholder="Chọn ngày trả phòng"
                            readonly
                            aria-required="true"
                            required
                        >
                    </div>
                    <p class="small text-muted">Phòng đã chọn: ID #{{selectedRoomId}}</p>
                    <div class="text-center">
                        <button type="submit" class="theme-btn btn-style-one" [disabled]="!bookingForm.valid">
                            <span class="btn-title">Xác nhận đặt phòng</span>
                        </button>
                        <button type="button" class="theme-btn btn-style-two ms-2" (click)="closeBookingModal()">
                            <span class="btn-title">Hủy</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Overlay for modal -->
<div class="modal-backdrop" *ngIf="showBookingModal" (click)="closeBookingModal()"></div>